version: '3'
services:
    zookeeper:
        build: ./zookeeper
        image: "myzookeeper"
        container_name: "zookeeper"
        ports:
            - "2001:2181"
        environment:
            ZOOKEEPER_MYID: 1
        volumes:
            - ./zookeeper/zoo.cfg:/home/zookeeper/apache-zookeeper-3.6.2-bin/conf/zoo.cfg
    broker1:
        build: ./kafkabroker
        depends_on:
            - zookeeper
        image: "mykafka"
        container_name: "broker1"
        ports:
            - "9001:9092"
        volumes:
            - ./kafkabroker/server1.properties:/home/kafka/kafka_2.13-2.6.0/config/server.properties
        hostname: "broker1"

    broker2:
        build: ./kafkabroker
        depends_on:
            - zookeeper
        image: "mykafka"
        container_name: "broker2"
        ports:
            - "9002:9092"
        volumes:
            - ./kafkabroker/server2.properties:/home/kafka/kafka_2.13-2.6.0/config/server.properties
        hostname: "broker2"

    broker3:
        build: ./kafkabroker
        depends_on:
            - zookeeper
        image: "mykafka"
        container_name: "broker3"
        ports:
            - "9003:9092"
        volumes:
            - ./kafkabroker/server3.properties:/home/kafka/kafka_2.13-2.6.0/config/server.properties
        hostname: "broker3"

    kafka_proxy:
        build: ./confluent
        depends_on:
            - broker1
            - broker2
            - broker3
        image: "myconfluent"
        container_name: "kafka_proxy"
        ports:
            - "8082:8082"
        volumes:
            - ./confluent/kafka-rest.properties:/home/confluent/confluent-6.0.0/etc/kafka-rest/kafka-rest.properties
        command: ["kafka-rest-start","/home/confluent/confluent-6.0.0/etc/kafka-rest/kafka-rest.properties"]

    kafka_connector1:
        depends_on:
            - broker1
            - broker2
            - broker3
        image: "mykafka"
        container_name: "kafka_connector1"
        ports:
            - "8083:8083"
        volumes:
            - ./kafkaconnector/connect-distributed.properties:/home/kafka/kafka_2.13-2.6.0/config/connect-distributed.properties
            - ./kafkaconnector/connector_plugins/lib:/home/kafka/connector_plugins/lib
            - ./kafkaconnector/connector_plugins/etc:/home/kafka/connector_plugins/etc
        command: ["connect-distributed.sh","/home/kafka/kafka_2.13-2.6.0/config/connect-distributed.properties","/home/kafka/connector_plugins/etc/quickstart-elasticsearch.properties"]

    kafka_connector2:
        depends_on:
            - broker1
            - broker2
            - broker3
        image: "mykafka"
        container_name: "kafka_connector2"
        ports:
            - "8084:8083"
        volumes:
            - ./kafkaconnector/connect-distributed.properties:/home/kafka/kafka_2.13-2.6.0/config/connect-distributed.properties
            - ./kafkaconnector/connector_plugins/lib:/home/kafka/connector_plugins/lib
            - ./kafkaconnector/connector_plugins/etc:/home/kafka/connector_plugins/etc
        command: ["connect-distributed.sh","/home/kafka/kafka_2.13-2.6.0/config/connect-distributed.properties","/home/kafka/connector_plugins/etc/quickstart-elasticsearch.properties"]

